<!DOCTYPE html>
<html>
  <head>
    <title>Apicolat</title>
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="assets/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="assets/statSort.css">
    <link rel="stylesheet" href="assets/simpleAxis.css">
    <style> 
      body { padding: 0 15px; }


      @font-face {
      font-family: 'Glyphicons Halflings';
      src: url('assets/fonts/glyphicons-halflings-regular.eot');
      src: url('assets/fonts/glyphicons-halflings-regular.eot?#iefix') format('embedded-opentype'), url('assets/fonts/glyphicons-halflings-regular.woff') format('woff'), url('assets/fonts/glyphicons-halflings-regular.ttf') format('truetype'), url('assets/fonts/glyphicons-halflings-regular.svg#glyphicons-halflingsregular') format('svg');
      }
    </style>
  </head>
  <body>

    <div class="container" style="padding-top: 100px">
      <div id="data"></div>
      <div id="chart" class="col-sm-6"></div>
      <div id="testDetails" class="col-sm-6">
        <p>
          <strong>Test: </strong><span class="test"></span>
        </p>
        <p>
          <strong>p-value: </strong><span class="pValue"></span>
        </p>
        <p>
          <strong>Description: </strong><span class="description"></span>
        </p>
      </div>
    </div>

    <script src="js/require.js"></script>
    <script>
     require.config({
       baseUrl: 'js',
       //urlArgs: "bust="+ Math.random(), // Usefull in development. Bust Caches
       packages: [{ name: 'when', location: 'vendor/when', main: 'when' }],
       paths: {
         jquery: 'vendor/jquery.min',
	 bootstrap: 'vendor/bootstrap.min',
	 d3: 'vendor/d3.v3.min',
	 vega: 'vendor/vega',
	 lodash: 'vendor/lodash.min',
         context: 'lib/indyva-js/context',
         hub: 'lib/indyva-js/hub',
	 FileSaver: 'vendor/FileSaver.min',
         'ws-rpc': 'lib/indyva-js/ws-rpc',
	 'reconnecting-websocket': 'lib/indyva-js/reconnecting-websocket'
       },
       shim: {
	 bootstrap: {deps: ['jquery']}
       }
     });
     
     requirejs(['jquery', 
		'lodash',
		'bootstrap', 
		'd3',
		'statSort',
		'simpleAxis'
     ],
     function ($, _, bootstrap, d3, StatSort) {
       data = JSON.parse('{"sorting":{"order":["new_subset-1","new_subset-2","new_subset-4","new_subset"],"equals":{"new_subset-1":null,"new_subset-2":["new_subset-4"],"new_subset-4":["new_subset-2"],"new_subset":null}},"tests":[{"pvalue":0.998385795346753,"decision":"* hypothesis accepted","test":"Two paired Kolmogorov Smirnov test","desc":"Comparing  Spine Area , subset new_subset-1 IS GREATER THAN subset new_subset-2","rejected":false,"warning":"","info":"Selecting 619 values as population samples for comparison of each variable.","subsetA":"new_subset-1","subsetB":"new_subset-2"},{"pvalue":1,"decision":"*** hypothesis accepted","test":"Two paired Kolmogorov Smirnov test","desc":"Comparing  Spine Area , subset new_subset IS LOWER THAN subset new_subset-1","rejected":false,"warning":"","info":"Selecting 619 values as population samples for comparison of each variable.","subsetA":"new_subset","subsetB":"new_subset-1"},{"pvalue":1,"decision":"*** hypothesis accepted","test":"Two paired Kolmogorov Smirnov test","desc":"Comparing  Spine Area , subset new_subset IS LOWER THAN subset new_subset-2","rejected":false,"warning":"","info":"Selecting 707 values as population samples for comparison of each variable.","subsetA":"new_subset","subsetB":"new_subset-2"},{"pvalue":1,"decision":"*** hypothesis accepted","test":"Two paired Kolmogorov Smirnov test","desc":"Comparing  Spine Area , subset new_subset-2 and subset new_subset-4 comes from THE SAME distribution","rejected":false,"warning":"","info":"Selecting 707 values as population samples for comparison of each variable.","subsetA":"new_subset-2","subsetB":"new_subset-4"}]}');

       //$('#data').text(JSON.stringify(data));
       window.d3 = d3;

       var svg = d3.select("#chart")
	 .append("svg")
	 .attr("width", "100%")
	 .attr("height", 500);


       var axis = d3.simpleAxis()
		    .width(40)
		    .height(300);
       svg.append("g")
	  .attr("transform", "translate(0, 20)")
	  .data(["Spine Area"])
	  .call(axis);

       var viz = svg.selectAll("viz")
	  .data([data.sorting]);
       
       var statSortChart = d3.statSort()
			     .width(300)
			     .height(300)
			     .itemHeight(50)
			     .itemWidth(130)
			     .origin(data.sorting.order[0]);
       var g = viz.enter().append("g").attr("transform", "translate(60, 20)");
       g.call(statSortChart);
       
       statSortChart.dispatch().on("itemclick", function(d){
	 statSortChart.origin(d).unselectLinks();
	 g.call(statSortChart);
	 showTestDetails([]);
       });

       statSortChart.dispatch().on("linkmouseover", function(d){
	 statSortChart.selectedLink(d.origin, d.target);
	 g.call(statSortChart);
	 showTestDetails(data.tests, d.origin, d.target);
       });

       function showTestDetails(tests, subsetX, subsetY) {
	 function foundTestResult(tests, subsetX, subsetY) {
	   var result = null;
	   tests.forEach(function(testResult){
	     if ((testResult.subsetA === subsetX  || testResult.subsetA === subsetY)
	       &&(testResult.subsetB === subsetX  || testResult.subsetB === subsetY) ) {
	       result = testResult;
	       }
	   });
	   return result;
	 }

	 var testResult = foundTestResult(tests, subsetX, subsetY);
	 if (testResult === null) {
	   $("#testDetails .test").text('');
	   $("#testDetails .pValue").text('');
	   $("#testDetails .description").text('');	   
	 }
	 else {
	   $("#testDetails .test").text(testResult.test);
	   $("#testDetails .pValue").text(d3.round(testResult.pvalue, 3));
	   $("#testDetails .description").text(testResult.desc);
	 }
       }

     }
     ); 
     

    </script>


  </body>
</html>
